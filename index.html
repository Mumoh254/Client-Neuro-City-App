<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    
    <!-- Primary Meta Tags -->
    <title>City Neuro App | Smart City Navigation & Community Hub</title>
    <meta name="description" content="City Neuro: Smart city navigation, safety features, and community engagement platform for urban citizens. Real-time updates and health resources." />
    <meta name="keywords" content="smart city, urban navigation, public safety, community hub, city health, real-time mapping, urban technology" />
    <meta name="author" content="Welt Tallis Development Team" />
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#1a365d">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="City Neuro">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="City Neuro - Smart City Platform">
    <meta property="og:description" content="Navigate smarter, live safer with City Neuro's integrated urban solutions">
    <meta property="og:image" content="/images/social-preview.png">
    <meta property="og:url" content="https://cityneuro.app">
    <meta name="twitter:card" content="summary_large_image">

    <!-- Icons & Manifest -->
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" href="/images/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#1a365d">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="/src/main.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" as="style" crossorigin="anonymous">
    <link rel="preload" href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.19.0/maps/maps.css" as="style">

    <!-- External Stylesheets -->
    <link rel="stylesheet" href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.19.0/maps/maps.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" 
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" 
        crossorigin="anonymous" />
</head>

<body class="d-flex flex-column min-vh-100">
    <div id="root" role="main"></div>
    
    <!-- Loading Indicator -->
    <div id="loading" class="loading-overlay" aria-live="polite">
        <div class="spinner"></div>
        <p>Loading Application...</p>
    </div>

    <!-- External Scripts -->
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.19.0/maps/maps-web.min.js" 
        defer 
        crossorigin="anonymous"></script>

    <!-- Service Worker Registration -->
    <script>
        (function() {
            // Loading state management
            const loadingEl = document.getElementById('loading');
            
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', async () => {
                    try {
                        const reg = await navigator.serviceWorker.register('/serviceworker.js', {
                            updateViaCache: 'none',
                            scope: '/'
                        });

                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification();
                                }
                            });
                        });

                        if (reg.waiting) {
                            showUpdateNotification();
                        }

                        let refreshing = false;
                        navigator.serviceWorker.addEventListener('controllerchange', () => {
                            if (!refreshing) {
                                window.location.reload();
                                refreshing = true;
                            }
                        });

                    } catch (error) {
                        console.error('Service Worker registration failed:', error);
                    } finally {
                        loadingEl.style.display = 'none';
                    }
                });

                // Network status detection
                window.addEventListener('online', () => showToast('Internet connection restored'));
                window.addEventListener('offline', () => showToast('You are currently offline'));
            }

            function showUpdateNotification() {
                if (confirm('A new version is available. Refresh to update?')) {
                    reg.waiting.postMessage({ type: 'SKIP_WAITING' });
                }
            }

            function showToast(message) {
                const toast = document.createElement('div');
                toast.className = `network-toast ${navigator.onLine ? 'online' : 'offline'}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        })();
    </script>
</body>
</html>